<html>
  <head>
    <title>{{ version.content.heading }} - Thread</title>
    {% include 'scripts.html' %}
    {% include 'diffstyles.html' %}
  </head>

  <body>
    {% include 'modules/login.html' %}

    <a href="{{ url_for('index') }}">Home</a>

    {% if version.primarydiff.headingchanged or version.primarydiff.nicknamechanged %}
      <ins><h1>[{{ version.content.heading }}, AKA "{{ version.content.nickname }}"]</h1></ins>
    {% else %}
      <h1>{{ version.content.heading }}, AKA "{{ version.content.nickname }}"</h1>
    {% endif %}

    <h3>{{ version.timestamp }}</h3>
    <a href="{{ url_for('edit', title=title) }}">Edit page</a>
    <a href="{{ url_for('history', title=title) }}">History</a>
    <a href="{{ url_for('page', title=title) }}">Latest version</a>

    <div>{{ version.primarydiff.summary|safe }}</div>

    {% from 'page-utils.html' import header_at_level %}
    {% for section in version.primarydiff.sections %}
      {% if section.deleted %}
        <div><del>[]</del></div>
      {% else %}
        {% if section.inserted %}
          {% set insertedheader %}
            <ins>[{{ section.header }}]</ins>
          {% endset %}
          {{ header_at_level(insertedheader, section.level) }}
        {% else %}
          {{ header_at_level(section.header, section.level) }}
        {% endif %}
        {{ section.diff|safe }}
      {% endif %}
    {% endfor %}

  </body>
</html>
