<html>
  <head>
    <title>Edit: {{ version.heading }} - Thread</title>
    {% include 'scripts.html' %}
  </head>

  <body>
    {% include 'modules/login.html' %}

    <a href="{{ url_for('index') }}">Home</a>

    <h1><span id="heading" contenteditable=true>{{ version.heading }}</span>, AKA "<span id="nickname" contenteditable=true>{{ version.nickname }}</span>"</h1>
    <a href="{{ url_for_title('page', title=title) }}">Back</a>
    <div id="pagebody" contenteditable="true">
      {{ version.summary|safe }}

      {% from 'page-utils.html' import header_at_level %}
      {% for section in version.sections %}
        {{ header_at_level(section.header, section.level) }}
        {{ section.body|safe }}
      {% endfor %}
    </div>
    <button type="button" onclick="submitedit(event)">Submit edit</button>
    <div id="editerror"></div>

    <script>
      function submitedit(event) {
        event.preventDefault();
        post("{{ url_for_title('submitedit', title=title) }}", {
          body: document.getElementById("pagebody").innerHTML,
          heading: document.getElementById("heading").innerText,
          nickname: document.getElementById("nickname").innerText,
          num: {{ version.num }},
        }).then((data) => {
          if (data.success) {
            window.location.href = data.redirect;
          } else {
            rerender(data.html);
          }
        });
      }
    </script>

  </body>
</html>
